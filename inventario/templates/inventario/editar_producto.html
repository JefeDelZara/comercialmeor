{% extends 'core/base.html' %}

{% load widget_tweaks %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h4 class="card-title text-center mb-4">Editar Producto</h4>

                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Nombre del Producto -->
                        <div class="form-group">
                            <label for="nombre">Nombre del Producto</label>
                            {{ form.nombre|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Descripción -->
                        <div class="form-group">
                            <label for="descripcion">Descripción</label>
                            {{ form.descripcion|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Precio de Venta -->
                        <div class="form-group">
                            <label for="precio_venta">Precio de Venta</label>
                            {{ form.precio_venta|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Precio de Compra -->
                        <div class="form-group">
                            <label for="precio_compra">Precio de Compra</label>
                            {{ form.precio_compra|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Categoría -->
                        <div class="form-group">
                            <label for="categoria">Categoría</label>
                            {% if form.categoria.errors %}
                                <div class="alert alert-danger">
                                    {% for error in form.categoria.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            {{ form.categoria|add_class:"form-control mb-3" }}
                            <small class="text-muted">Si no encuentras tu categoría, puedes crear una nueva.</small>
                            <a href="{% url 'inventario:crear_categoria' %}" class="btn btn-link btn-sm">Crear Nueva Categoría</a>
                        </div>

                        <!-- Marca -->
                        <div class="form-group">
                            <label for="marca">Marca</label>
                            {{ form.marca|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Stock -->
                        <div class="form-group">
                            <label for="stock">Stock</label>
                            {{ form.stock|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Stock Mínimo -->
                        <div class="form-group">
                            <label for="stock_minimo">Stock Mínimo</label>
                            {{ form.stock_minimo|add_class:"form-control mb-3" }}
                        </div>

                        <!-- Imagen 1 -->
                        <div class="form-group">
                            <label for="imagen1">Imagen 1</label>
                            {{ form.imagen1|add_class:"form-control-file mb-3" }}
                            {% if producto.imagen1 %}
                                <img id="preview1" class="mt-3" src="{{ producto.imagen1.url }}" alt="Vista previa" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                            {% else %}
                                <img id="preview1" class="mt-3" src="{% static 'images/default-product.jpg' %}" alt="Vista previa" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                            {% endif %}
                        </div>

                        <!-- Imagen 2 -->
                        <div class="form-group">
                            <label for="imagen2">Imagen 2</label>
                            {{ form.imagen2|add_class:"form-control-file mb-3" }}
                            {% if producto.imagen2 %}
                                <img id="preview2" class="mt-3" src="{{ producto.imagen2.url }}" alt="Vista previa" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                            {% else %}
                                <img id="preview2" class="mt-3" src="{% static 'images/default-product.jpg' %}" alt="Vista previa" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                            {% endif %}
                        </div>

                        <!-- Imagen 3 -->
                        <div class="form-group">
                            <label for="imagen3">Imagen 3</label>
                            {{ form.imagen3|add_class:"form-control-file mb-3" }}
                            {% if producto.imagen3 %}
                                <img id="preview3" class="mt-3" src="{{ producto.imagen3.url }}" alt="Vista previa" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                            {% else %}
                                <img id="preview3" class="mt-3" src="{% static 'images/default-product.jpg' %}" alt="Vista previa" style="width: 150px; height: 150px; object-fit: cover; border: 1px solid #ccc;">
                            {% endif %}
                        </div>

                        <!-- Botón para enviar el formulario -->
                        <div class="form-group text-center">
                            <button type="submit" class="btn btn-primary btn-lg">Guardar Cambios</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('id_imagen1').addEventListener('change', function (event) {
        const preview = document.getElementById('preview1');
        preview.src = URL.createObjectURL(event.target.files[0]);
    });

    document.getElementById('id_imagen2').addEventListener('change', function (event) {
        const preview = document.getElementById('preview2');
        preview.src = URL.createObjectURL(event.target.files[0]);
    });

    document.getElementById('id_imagen3').addEventListener('change', function (event) {
        const preview = document.getElementById('preview3');
        preview.src = URL.createObjectURL(event.target.files[0]);
    });
</script>
{% endblock %}
